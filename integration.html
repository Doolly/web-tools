<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />

  <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" />
  <link rel="stylesheet" href="gui.css">

  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.23/jquery-ui.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.7.3/nipplejs.js"></script>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/EaselJS/1.0.2/easeljs.min.js"></script>
  <script type="text/javascript" src="https://unpkg.com/eventemitter2@6.4.3/lib/eventemitter2.js"></script>
  <script type="text/javascript" src="https://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
  <script type="text/javascript" src="https://static.robotwebtools.org/ros2djs/current/ros2d.min.js"></script>
  <script type="text/javascript" src="http://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
  <script type="text/javascript" src="http://static.robotwebtools.org/keyboardteleopjs/current/keyboardteleop.min.js"></script>
  <script type="text/javascript" src="https://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
  <script type="text/javascript" src="http://static.robotwebtools.org/mjpegcanvasjs/current/mjpegcanvas.min.js"></script>
  <script type="text/javascript" src="http://static.robotwebtools.org/ros3djs/current/ros3d.min.js"></script>
  <script src="ros.js"></script>


  <script type="text/javascript">
    /**
     * Setup all GUI elements when the page is loaded.
     */

    function init() {
      // Connect to ROS.
      var ros = new ROSLIB.Ros({
        url: 'ws://localhost:9090'
      });
      

      /////////////////////////////////////////////////////////////////
      ///////////////////////////* Nav Map *///////////////////////////
      /////////////////////////////////////////////////////////////////    

      // Create the main viewer.
      var viewer = new ROS2D.Viewer({
        divID: 'nav',
        width: 750,
        height: 600
      });


      /////////////////////////////////////////////////////////////////
      ///////////////////////* Teleop and Bar *////////////////////////
      /////////////////////////////////////////////////////////////////

      // Initialize the teleop.
      var teleop = new KEYBOARDTELEOP.Teleop({
        ros: ros,
        topic: '/cmd_vel'
      });

      // Create a UI slider using JQuery UI.
      $('#speed-slider').slider({
        range: 'min',
        min: 0,
        max: 100,
        value: 50,
        slide: function (event, ui) {
          // Change the speed label.
          $('#speed-label').html('Speed: ' + ui.value + '%');
          // Scale the speed.
          teleop.scale = (ui.value / 100.0);
        }
      });

      // Set the initial speed .
      $('#speed-label').html('Speed: ' + ($('#speed-slider').slider('value')) + '%');
      teleop.scale = ($('#speed-slider').slider('value') / 100.0);


      /////////////////////////////////////////////////////////////////
      ////////////////////////* Camera Viewer *////////////////////////
      /////////////////////////////////////////////////////////////////

      var viewer = new MJPEGCANVAS.Viewer({
        divID: 'mjpeg',
        host: 'localhost',
        width: 640,
        height: 480,
        topic: '/camera/rgb/image_raw'
      });


      /////////////////////////////////////////////////////////////////
      ///////////////////////////* Joystick *//////////////////////////
      /////////////////////////////////////////////////////////////////

      cmd_vel_listener = new ROSLIB.Topic({
        ros : ros,
        name : "/cmd_vel",
        messageType : 'geometry_msgs/Twist'
      });

      move = function (linear, angular) {
        var twist = new ROSLIB.Message({
          linear: {
            x: linear,
            y: 0,
            z: 0
          },
          angular: {
            x: 0,
            y: 0,
            z: angular
          }
        });
        cmd_vel_listener.publish(twist);
      }

      createJoystick = function () {
        var options = {
          zone: document.getElementById('zone_joystick'),
          threshold: 0.1,
          position: { left: 50 + '%' },
          mode: 'static',
          size: 150,
          color: '#000000',
        };
        manager = nipplejs.create(options);

        linear_speed = 0;
        angular_speed = 0;

        manager.on('start', function (event, nipple) {
          console.log("Movement start");
        });

        manager.on('move', function (event, nipple) {
          console.log("Moving");

        });

        manager.on('end', function () {
          console.log("Movement end");
      
        });
      }

      createJoystick();
    }

  </script>



</head>

  <body onload="init()">
    <p>Connection status: <span id="status"></span></p>
    <!-- speed bar is just for teleop -->
    <div id="speed-label"></div>
    <div id="speed-slider"></div>

    <h1>Control with Web</h1>
    <div id="container_1" style="position: fixed; top: 12%; left: 0%; ">

      <div id="nav" ></div>
      <div id="mjpeg" style="position: fixed; top: 9.5%; left: 50%;" ></div>
      <div id="zone_joystick" style="position: fixed; top: 60%; left: 80%; "></div>
    </div>
    
    <div id="container_2" style="position: fixed; top: 65%; ">
      <div class="item item-main-1">
        <button class="emtion-btn" id="blink">blink</button>
        <button class="emtion-btn" id="boot_up">boot_up</button>
        <button class="emtion-btn" id="dead">dead</button>
        <button class="emtion-btn" id="delivered_1">delivered_1</button>
      </div>
      <div class="item item-main-2">
        <button class="emtion-btn" id="delivered_2">delivered_2</button>
        <button class="emtion-btn" id="eat_box">eat_box</button>
        <button class="emtion-btn" id="elevator">elevator</button>
        <button class="emtion-btn" id="looking_left">looking_left</button>
      </div>
      <div class="item item-main-3">
        <button class="emtion-btn" id="moving">moving</button>
        <button class="emtion-btn" id="normal">normal</button>
        <button class="emtion-btn" id="sad">sad</button>
        <button class="emtion-btn" id="sad_more">sad_more</button>
      </div>
      <div class="item item-main-4">
        <button class="emtion-btn" id="sleep">sleep</button>
        <button class="emtion-btn" id="surprised">surprised</button>
      </div>
    </div>
    
    <div id="container_3" style="position: fixed; top: 65%; left: 40%; ">

      <div class="item item-main-5" >
        <button class="emtion-btn" id="going_up">going_up</button>
        <button class="emtion-btn" id="four">four</button>
        <button class="emtion-btn" id="five">five</button>
        <button class="emtion-btn" id="six">six</button>
      </div>
    </div>

    <script src="main.js"></script>

  </body>

</html>